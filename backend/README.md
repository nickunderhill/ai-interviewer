# AI Interviewer - Backend

FastAPI backend service for the AI-powered technical interview practice system.

## Tech Stack

- **Framework**: FastAPI 0.108.0
- **Python**: 3.12.7
- **Database**: PostgreSQL with SQLAlchemy 2.0.23
- **Authentication**: JWT with python-jose
- **Testing**: pytest, pytest-asyncio, httpx

## Project Structure

```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py           # FastAPI application entry point
│   ├── api/              # API endpoints
│   ├── core/             # Core functionality (config, security, etc.)
│   ├── models/           # SQLAlchemy ORM models
│   ├── schemas/          # Pydantic schemas for validation
│   ├── services/         # Business logic layer
│   └── utils/            # Utility functions
├── tests/                # Test files
├── requirements.txt      # Python dependencies
├── .env.example          # Environment variables template
└── README.md            # This file
```

## Getting Started

### Prerequisites

- Python 3.12.7 or higher
- pip (Python package manager)
- PostgreSQL database (for future database integration)

### Installation

1. **Navigate to backend directory:**

   ```bash
   cd backend
   ```

2. **Create and activate virtual environment:**

   ```bash
   python -m venv venv
   source venv/bin/activate  # On macOS/Linux
   # or
   venv\Scripts\activate  # On Windows
   ```

3. **Install dependencies:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Set up environment variables:**
   ```bash
   cp .env.example .env
   # Edit .env with your configuration
   ```

### Running the Server

**Development mode with auto-reload:**

```bash
uvicorn app.main:app --reload --port 8000
```

**Production mode:**

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

The API will be available at:

- API: http://localhost:8000
- Interactive docs (Swagger): http://localhost:8000/docs
- Alternative docs (ReDoc): http://localhost:8000/redoc

### Running Tests

**Run all tests:**

```bash
pytest
```

**Run with coverage:**

```bash
pytest --cov=app tests/
```

**Run specific test file:**

```bash
pytest tests/test_main.py
```

## API Endpoints

### Health Check

- `GET /` - Root endpoint with API information
- `GET /api/v1/health` - Health check endpoint

## Database Migrations with Alembic

This project uses [Alembic](https://alembic.sqlalchemy.org/) for database
migrations.

### Common Alembic Commands

**Generate a new migration from model changes (autogenerate):**

```bash
alembic revision --autogenerate -m "description of changes"
```

**Create a manual migration:**

```bash
alembic revision -m "description of changes"
```

**Apply all pending migrations:**

```bash
alembic upgrade head
```

**Rollback one migration:**

```bash
alembic downgrade -1
```

**Rollback to specific revision:**

```bash
alembic downgrade <revision_id>
```

**Rollback all migrations:**

```bash
alembic downgrade base
```

**Show current migration version:**

```bash
alembic current
```

**Show migration history:**

```bash
alembic history
```

### Migration Workflow

1. **Create/modify SQLAlchemy models** in `app/models/`
2. **Import new models** in `alembic/env.py` (required for autogenerate)
3. **Generate migration**: `alembic revision --autogenerate -m "add user model"`
4. **Review the generated migration** in `alembic/versions/`
5. **Apply migration**: `alembic upgrade head`
6. **Commit migration file** to version control

### Important Notes

- Always review autogenerated migrations before applying
- Test both `upgrade()` and `downgrade()` functions
- Migrations are tracked in `alembic_version` table
- Use descriptive messages for migration names
- Backup production database before running migrations
- Alembic uses a **synchronous** database connection for migrations
- The application uses an **asynchronous** SQLAlchemy engine for runtime
  operations

### Best Practices

#### Manual vs Autogenerate Migrations

- **Autogenerate** (`alembic revision --autogenerate -m "message"`):
  - Detects most schema changes automatically (tables, columns, indexes)
  - Always review generated code - it may miss renames or complex changes
  - Cannot detect: table/column renames, custom constraints, some data types
- **Manual** (`alembic revision -m "message"`):
  - Use for data migrations (transforming existing data)
  - Use when autogenerate misses changes
  - Required for complex multi-step migrations

#### Data Migrations

- Never put data transformations in model changes
- Create separate migration for data operations
- Always test rollback (downgrade) with real data
- Example: Adding non-nullable column requires 3 steps:
  1. Add column as nullable
  2. Populate data
  3. Make column non-nullable

#### Rollback Strategy

- Test downgrade before deploying to production
- Keep migrations small and reversible
- Document irreversible migrations clearly
- Maintain data backups before running migrations
- Use `alembic downgrade -1` to revert last migration

#### Common Pitfalls

- Don't edit applied migrations - create new ones to fix issues
- Don't delete migration files from versions/ directory
- Always commit migrations with code changes that depend on them
- Review autogenerated migrations for accuracy before applying

## Environment Variables

See [.env.example](.env.example) for all available environment variables.

Key variables:

- `CORS_ORIGINS` - Comma-separated list of allowed CORS origins
- `DATABASE_URL` - PostgreSQL connection string
- `SECRET_KEY` - JWT secret key
- `ENVIRONMENT` - Application environment (development/production)

## Development

### Code Style

- Follow PEP 8 guidelines
- Use type hints for all functions
- Write docstrings for all public functions and classes

### Testing

- Write tests for all new features
- Maintain test coverage above 80%
- Use pytest fixtures for common test setup

## License

This project is part of a diploma project.
